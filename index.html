<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>OMNISCIENTRIX MAP — Life & Earth-Likeness Finder</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
html, body {
  margin: 0; padding: 0;
  overflow: hidden;
  background: #000;
  font-family: Arial, sans-serif;
  color: #00aaff;
}

/* UI PANEL */
#ui {
  position: fixed;
  top: 10px; left: 10px;
  width: 300px;
  background: rgba(0,0,0,0.55);
  padding: 15px;
  border-radius: 10px;
  border: 1px solid #00aaff55;
  backdrop-filter: blur(6px);
}

#ui h1 { font-size: 20px; margin: 0 0 10px 0; color: #00caff; }
#ui h2 { font-size: 14px; margin: 10px 0 3px 0; color: #00d0ff; }
#ui p  { font-size: 12px; }

/* SECTION BOX */
#planet-info {
  margin-top: 10px;
  padding: 10px;
  border: 1px solid #005577;
  border-radius: 6px;
}

/* FOOTER */
#footer {
  position: fixed;
  bottom: 10px;
  left: 50%; transform: translateX(-50%);
  font-size: 12px;
  opacity: 0.7;
  color: #0099ff;
}
</style>
</head>

<body>

<div id="ui">
  <h1>OMNISCIENTRIX MAP</h1>
  <h2>Life-Finder Controls</h2>
  <p><b>Click any glowing planet-node</b> to inspect life probability.</p>

  <h2>Current Selection:</h2>
  <div id="planet-info">No planet selected.</div>
</div>

<canvas id="universe"></canvas>

<div id="footer">© 2025 Cornelius Aurelius · <a style="color:#00aaff;">The Peace License</a></div>

<script>
/* -----------------------------------------------------------
   FIXED RENDER ENGINE — GUARANTEED TO WORK ON ALL BROWSERS
----------------------------------------------------------- */
const canvas = document.getElementById("universe");
const ctx = canvas.getContext("2d"); // <-- guaranteed everywhere

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.onresize = resize;

/* -----------------------------------------------------------
   PROCEDURAL GALAXY + EXOPLANET GENERATION
----------------------------------------------------------- */
const STAR_COUNT = 6000;
const PLANET_COUNT = 250;

let stars = [];
let planets = [];

// Generate Stars
for (let i = 0; i < STAR_COUNT; i++) {
  stars.push({
    x: (Math.random() - 0.5) * 4000,
    y: (Math.random() - 0.5) * 4000,
    z: Math.random() * 3000 + 100,
    b: Math.random()
  });
}

// Generate Exoplanets
for (let i = 0; i < PLANET_COUNT; i++) {
  const s = stars[Math.floor(Math.random() * stars.length)];
  const dist = 20 + Math.random() * 80;

  planets.push({
    name: "PX-" + (1000 + i),

    x: s.x + (Math.random() - 0.5) * dist,
    y: s.y + (Math.random() - 0.5) * dist,
    z: s.z + (Math.random() - 0.5) * dist,

    radius: 0.5 + Math.random() * 2.5,
    temp: 150 + Math.random() * 400,
    flux: 0.1 + Math.random() * 2.5,
    water: Math.random(),
    atmosphere: Math.random(),

    o2: Math.random() * 0.21,
    ch4: Math.random() * 0.02,
    co2: Math.random() * 0.10,

    esi: 0,
    iels: 0,
    lifeScore: 0,
    screen: {x:0,y:0}
  });
}

/* -----------------------------------------------------------
   EARTH SIMILARITY INDEX (ESI)
----------------------------------------------------------- */
function computeESI(p) {
  const r = Math.abs((p.radius - 1) / (p.radius + 1));
  const t = Math.abs((p.temp - 288) / (p.temp + 288));
  return 1 - (r * 0.5 + t * 0.5);
}

/* -----------------------------------------------------------
   INFORM. EARTH-LIKENESS SCORE (IELS)
----------------------------------------------------------- */
function computeIELS(p) {
  const tempTerm = Math.exp(-Math.abs(p.temp - 288) / 80);
  const waterTerm = p.water;
  const atmoTerm = p.atmosphere;
  const fluxTerm = Math.exp(-Math.abs(p.flux - 1));
  return tempTerm * 0.35 + waterTerm * 0.35 + atmoTerm * 0.15 + fluxTerm * 0.15;
}

/* -----------------------------------------------------------
   LIFE SCORE = IELS + ESI + BIOSIGNATURES
----------------------------------------------------------- */
function computeLifeScore(p) {
  const biosig = (p.o2 * p.ch4) > 0.0005 ? 1 : 0;
  return (p.iels * 0.6) + (p.esi * 0.3) + (biosig * 0.1);
}

/* Compute scores */
planets.forEach(p => {
  p.esi = computeESI(p);
  p.iels = computeIELS(p);
  p.lifeScore = computeLifeScore(p);
});

/* -----------------------------------------------------------
   CAMERA CONTROLS
----------------------------------------------------------- */
let cam = { x:0, y:0 };
document.addEventListener("mousemove", e => {
  cam.x = (e.clientX / window.innerWidth - 0.5) * 200;
  cam.y = (e.clientY / window.innerHeight - 0.5) * 200;
});

/* -----------------------------------------------------------
   RENDER LOOP
----------------------------------------------------------- */
function render() {
  ctx.fillStyle = "black";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Draw stars
  for (let s of stars) {
    const depth = s.z / 3000;
    const x = canvas.width/2 + s.x / depth + cam.x * 0.5;
    const y = canvas.height/2 + s.y / depth + cam.y * 0.5;

    ctx.fillStyle = `rgba(0,150,255,${0.2 + s.b * 0.8})`;
    ctx.fillRect(x, y, 1.5, 1.5);
  }

  // Draw planets
  for (let p of planets) {
    const depth = p.z / 3000;
    const x = canvas.width/2 + p.x / depth + cam.x * 0.5;
    const y = canvas.height/2 + p.y / depth + cam.y * 0.5;

    const c = Math.min(1, p.lifeScore);
    ctx.fillStyle = `rgba(${(1-c)*0},${c*255},255,1)`;

    ctx.beginPath();
    ctx.arc(x, y, 3 + c * 3, 0, Math.PI * 2);
    ctx.fill();

    p.screen.x = x; p.screen.y = y;
  }

  requestAnimationFrame(render);
}
render();

/* -----------------------------------------------------------
   CLICK SELECTION
----------------------------------------------------------- */
canvas.addEventListener("click", e => {
  for (let p of planets) {
    if (Math.hypot(e.clientX - p.screen.x, e.clientY - p.screen.y) < 8) {
      document.getElementById("planet-info").innerHTML = `
        <b>${p.name}</b><br>
        Radius: ${p.radius.toFixed(2)} R⊕<br>
        Temp: ${p.temp.toFixed(0)} K<br>
        ESI: ${(p.esi*100).toFixed(1)}%<br>
        IELS: ${(p.iels*100).toFixed(1)}%<br>
        Life Score: ${(p.lifeScore*100).toFixed(1)}%<br>
        Water Probability: ${(p.water*100).toFixed(1)}%<br>
        Atmosphere: ${(p.atmosphere*100).toFixed(1)}%<br>
        O₂: ${(p.o2*100).toFixed(2)}%<br>
        CH₄: ${(p.ch4*100).toFixed(2)}%<br>
        CO₂: ${(p.co2*100).toFixed(2)}%
      `;
      break;
    }
  }
});
</script>

</body>
</html>
